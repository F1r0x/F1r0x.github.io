# Dirty Cow

## ¿Qué es Dirty Cow?

Dirty COW (Dirty copy-on-write) es una vulnerabilidad de seguridad informática para el kernel de Linux que afectó a todos los 
sistemas operativos basados en Linux, incluidos los dispositivos Android, que usaban versiones anteriores del kernel de Linux 
creadas antes de 2018.

Concretamente afecta a las versiones desde la 2.6.22 hasta la 3.9 del kernel de Linux.

## ¿Cómo funciona Dirty Cow?

Este exploit utiliza el exploit `pokemon` de la vulnerabilidad dirtycow.

El exploit aprovecha una vulnerabilidad en el código del kernel de Linux a través del cual genera automáticamente una nueva línea `passwd`(/etc/passdw). 

Se le pedirá al usuario la nueva contraseña cuando se ejecute el binario. 

A continuación, se realiza una copia de seguridad del archivo `/etc/passwd` original en `/tmp/passwd.bak` y sobrescribe la cuenta raíz con la
línea generada. Esto podemos comprobarlo haciendo un `cat` en el archivo `passwd`:

    cat /etc/passwd
    
![Captura de pantalla 2022-08-04 031357](https://user-images.githubusercontent.com/103068924/182746135-250eed29-7793-471c-b274-043ae2f88f84.png)

Después de ejecutar el exploit, debería poder iniciar sesión con el usuario recién creado. Por defecto se creará el Usurio `firefart`. Podemos
cambiar el nombre dentro del exploit y proporcionarle el que queramos.

![Captura de pantalla 2022-08-04 031524](https://user-images.githubusercontent.com/103068924/182746181-88bf1e37-8627-4a38-89b1-373d990b9a76.png)

![Captura de pantalla 2022-08-04 031701](https://user-images.githubusercontent.com/103068924/182746205-34d43fb9-5c48-4270-b1ac-3a9d121d9950.png)

Exploit original: https://www.exploit-db.com/exploits/40839

## Como saber que un equipo es vulnerable al Dirty Cow:

Básicamente para comprobar si un sistema Linux es vulnerable al Dirty Cow es revisando la versión del kernel. Si la versión del kernel está entre
la 2.6.22 hasta la 3.9 es muy posible que sea vulnerable. Para comprobar la versión del kernel podemos utilizar el comando:

    uname -a
    
![Captura de pantalla 2022-08-04 034452](https://user-images.githubusercontent.com/103068924/182746307-77b0b46f-f8d8-4e39-aed7-209f7b32bb63.png)

## Instalación del exploit:

Para instalar el Dirty Cow primero debemos tener acceso al sistema y poder descargar el binario en el equipo vícitma, podemos descargarlo desde 
el repositorio original o desde GitHub si nos permite realizar un `git clone` o podemos copiarlo directamente desde el buscador y crear el
archivo (mediante `nano` por ejemplo).

* <a href="https://www.exploit-db.com/exploits/40839" style="text-decoration:none">Copiar de Aquí.</a>

Podemos crear el archivo `dirty.c` utilizado `nano` y pegar el código del exploit.

Una vez descargado o creado lo debemos compilar con: 

    gcc -pthread dirty.c -o dirty -lcrypt 
    
![Captura de pantalla 2022-08-04 031828](https://user-images.githubusercontent.com/103068924/182746374-e0239b7d-abe1-488e-a469-f67706a5317c.png)
    
## Ejecución del Exploit:    

Ahora para ejecutar el binario utilizamos el siguiente comando:

    ./dirty
    
 ![Captura de pantalla 2022-08-04 031905](https://user-images.githubusercontent.com/103068924/182746270-b2880a65-5126-47c8-8aea-48ab48177e8c.png)   
  
 Tras ejecutarlo nos pedira que ingresemos una nueva contraseña.    
    
 Finalmente, una vez creada la nueva contraseña, se alojara el nuevo usuario en el `/etc/passwd`  y podremos ingresar como ese usuario
 el cual tendrá privilegios de superhusuario o `root`.
 
 Para acceder al usuario:
 
     su firefart
     
 * `firefart`: Es el usuario predeterminado del esploit.    
     
 Para acceder a través de un servicio `ssh`:    
     
     ssh firefart@[Ip Vícitma]

---
---
  
    
<html lang="en">
<head>
  
</head>
<body>

<script src="https://utteranc.es/client.js"
    repo="F1r0x/gestion-comentarios"
    issue-term="pathname"
    theme="github-light"
    crossorigin="anonymous"
    async>
</script>
          
    
  </body>
</html>
  
  
---
---

